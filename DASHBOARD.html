<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School ERP Dashboard</title>
    <link rel="stylesheet" href="STYLES.css">
</head>
<body>
    <script>
        // Check if the user is logged in before rendering the page
        if (!localStorage.getItem('loggedInUser')) {
            window.location.href = "LOGIN.html";
        }
    </script>

    <aside class="sidebar">
        <h2>School ERP</h2>
        <nav>
            <ul>
                <li><a href="DASHBOARD.html">Dashboard</a></li>
                <li><a href="STUDENT_MANAGEMENT.html">Student Management</a></li>
                <li><a href="TEACHER_MANAGEMENT.html">Teacher Management</a></li>
                <li><a href="CLASS_MANAGEMENT.html">Class Management</a></li>
                <li><a href="ATTENDANCE.html">Attendance</a></li>
                <li><a href="EXAM_MANAGEMENT.html">Exams & Grades</a></li>
                <li><a href="MY_PROFILE.html">My Profile</a></li>
                <li><a href="LOGIN.html">Logout</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h1>Welcome, Administrator</h1>
        <p>This is a dashboard overview. You can navigate through the different sections using the menu on the left.</p>

        <div class="card">
            <h2>Quick Stats</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>Total Students</h3>
                    <p id="total-students">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Total Teachers</h3>
                    <p id="total-teachers">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Total Classes</h3>
                    <p id="total-classes">Loading...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Recent Activities</h2>
            <ul>
                <li>New student enrolled: John Doe</li>
                <li>Exam schedule updated for Grade 10</li>
                <li>Attendance for today has been submitted</li>
            </ul>
        </div>
    </main>
    
    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzDvGPCnsWEPUE-hRS1MhhCPlK19u5KAomHM_bt1MN9jrtNv4l3ZAXiVPG7CVNXECQJ/exec';
        
        async function fetchDashboardStats() {
            try {
                // Fetch data for all three sections in parallel
                const [studentsRes, teachersRes, classesRes] = await Promise.all([
                    fetch(`${scriptURL}?action=getStudents`),
                    fetch(`${scriptURL}?action=getTeachers`),
                    fetch(`${scriptURL}?action=getClasses`)
                ]);
                
                const studentsData = await studentsRes.json();
                const teachersData = await teachersRes.json();
                const classesData = await classesRes.json();

                // Update the dashboard elements with the fetched data
                document.getElementById('total-students').textContent = studentsData.students.length;
                document.getElementById('total-teachers').textContent = teachersData.teachers.length;
                document.getElementById('total-classes').textContent = classesData.classes.length;

            } catch (error) {
                console.error('Error fetching dashboard stats:', error);
                document.getElementById('total-students').textContent = 'N/A';
                document.getElementById('total-teachers').textContent = 'N/A';
                document.getElementById('total-classes').textContent = 'N/A';
            }
        }

        // Call the function to load the data when the page loads
        fetchDashboardStats();
    </script>
</body>
</html>