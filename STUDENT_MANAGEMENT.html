<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
   <link rel="stylesheet" href="STYLES.css">
</head>
<body>
    <aside class="sidebar">
        <h2>School ERP</h2>
        <nav>
            <ul>
               <li><a href="DASHBOARD.html">Dashboard</a></li>
                <li><a href="STUDENT_MANAGEMENT.html">Student Management</a></li>
                <li><a href="TEACHER_MANAGEMENT.html">Teacher Management</a></li>
                <li><a href="CLASS_MANAGEMENT.html">Class Management</a></li>
                <li><a href="ATTENDANCE.html">Attendance</a></li>
                <li><a href="EXAM_MANAGEMENT.html">Exams & Grades</a></li>
                <li><a href="MY_PROFILE.html">My Profile</a></li>
                <li><a href="LOGIN.html">Logout</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h1>Student Management</h1>
        <p>List of all students in the school.</p>
        
        <div class="card">
            <h2>Add New Student</h2>
            <form id="add-student-form" class="form-container">
                <input type="text" id="student-name" name="StudentName" placeholder="Student Name" required>
                <input type="text" id="admission-number" name="AdmissionNumber" placeholder="Admission Number" required>
                <input type="text" id="student-class" name="Class" placeholder="Class" required>
                <input type="email" id="student-email" name="Email" placeholder="Email Address">
                <input type="text" id="student-username" name="Username" placeholder="Username" required>
                <input type="password" id="student-password" name="Password" placeholder="Password" required>
                <button type="submit">Add Student</button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Admission No.</th>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="student-table-body">
            </tbody>
        </table>
    </main>
    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw1t_ljhXOQsoN0mnpamRSqoPILBvPpmnvhkEw0l3_p8MJMGKg9cMyP3_M23__QxWgfXw/exec';
        const studentForm = document.getElementById('add-student-form');
        const studentTableBody = document.getElementById('student-table-body');
        
        async function fetchStudents() {
            try {
                const response = await fetch(`${scriptURL}?action=getStudents`);
                const data = await response.json();
                studentTableBody.innerHTML = '';
                data.students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.AdmissionNumber}</td>
                        <td>${student.StudentName}</td>
                        <td>${student.Class}</td>
                        <td>${student.Email}</td>
                        <td class="action-links">
                            <div class="action-buttons">
                                <a href="#">View Profile</a>
                                <a href="#">Edit</a>
                            </div>
                        </td>
                    `;
                    studentTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching student data:', error);
                studentTableBody.innerHTML = '<tr><td colspan="5">Error loading student data.</td></tr>';
            }
        }
        
        studentForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.append('formType', 'student');
            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.status === 'success') {
                    alert('Student added successfully!');
                    studentForm.reset();
                    fetchStudents();
                } else {
                    alert('Error adding student: ' + result.message);
                }
            } catch (error) {
                console.error('Error!', error.message);
                alert('An error occurred. Please try again.');
            }
        });
        
        fetchStudents();
    </script>
</body>
</html>