<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Management</title>
   <link rel="stylesheet" href="STYLES.css">
</head>
<body>
    <aside class="sidebar">
        <h2>School ERP</h2>
        <nav>
            <ul>
               <li><a href="DASHBOARD.html">Dashboard</a></li>
                <li><a href="STUDENT_MANAGEMENT.html">Student Management</a></li>
                <li><a href="TEACHER_MANAGEMENT.html">Teacher Management</a></li>
                <li><a href="CLASS_MANAGEMENT.html">Class Management</a></li>
                <li><a href="ATTENDANCE.html">Attendance</a></li>
                <li><a href="EXAM_MANAGEMENT.html">Exams & Grades</a></li>
                <li><a href="MY_PROFILE.html">My Profile</a></li>
                <li><a href="LOGIN.html">Logout</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h1>Class Management</h1>
        <p>Manage all classes, their sections, and assigned teachers.</p>
        
        <div class="card">
            <h2>Add New Class</h2>
            <form id="add-class-form" class="form-container">
                <input type="text" id="class-name" name="ClassName" placeholder="Class Name" required>
                <input type="text" id="section" name="Section" placeholder="Section" required>
                <select id="assigned-teacher" name="AssignedTeacher" required>
                    <option value="">-- Select Teacher --</option>
                </select>
                <input type="number" id="number-of-students" name="NumberofStudents" placeholder="Number of Students" required>
                <button type="submit">Add Class</button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Class Name</th>
                    <th>Section</th>
                    <th>Assigned Teacher</th>
                    <th>Number of Students</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="class-table-body">
                </tbody>
        </table>
    </main>
    
    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwuq2RW99LBs2-i35g8F7A2juNzcdPBCXGs0i3k-l27HjFLXsuIdao8X0PKwizAjR17rA/exec';
        const classTableBody = document.getElementById('class-table-body');
        const addClassForm = document.getElementById('add-class-form');
        const assignedTeacherSelect = document.getElementById('assigned-teacher');

        async function fetchTeachers() {
            try {
                const response = await fetch(`${scriptURL}?action=getTeachers`);
                const data = await response.json();
                
                data.teachers.forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher.TeacherName;
                    option.textContent = teacher.TeacherName;
                    assignedTeacherSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching teacher data:', error);
                // Optionally add a fallback or error message to the dropdown
            }
        }
        
        async function fetchClasses() {
            try {
                const response = await fetch(`${scriptURL}?action=getClasses`);
                const data = await response.json();
                
                classTableBody.innerHTML = ''; // Clear existing content
                
                data.classes.forEach(cls => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${cls.ClassName}</td>
                        <td>${cls.Section}</td>
                        <td>${cls.AssignedTeacher}</td>
                        <td>${cls.NumberofStudents}</td>
                        <td class="action-links">
                            <div class="action-buttons">
                                <a href="#">View Students</a>
                                <a href="#">Edit</a>
                            </div>
                        </td>
                    `;
                    classTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching class data:', error);
                classTableBody.innerHTML = '<tr><td colspan="5">Error loading class data.</td></tr>';
            }
        }

        addClassForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.append('formType', 'class');
            
            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    alert('Class added successfully!');
                    addClassForm.reset();
                    fetchClasses(); // Refresh the table
                } else {
                    alert('Error adding class: ' + result.message);
                }
            } catch (error) {
                console.error('Error submitting class:', error);
                alert('An error occurred. Please try again.');
            }
        });
        
        // Load data when the page loads
        fetchTeachers();
        fetchClasses();
    </script>
</body>
</html>