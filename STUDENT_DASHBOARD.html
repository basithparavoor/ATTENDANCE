<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="STYLES.css">
</head>
<body>
    <aside class="sidebar">
        <h2>School ERP</h2>
        <nav>
            <ul>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">My Profile</a></li>
                <li><a href="#">My Schedule</a></li>
                <li><a href="#">My Grades</a></li>
                <li><a href="#">Exams & Tests</a></li>
                <li><a href="#">Logout</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h1 id="student-name-heading"></h1>
        <p>Welcome to your personalized student dashboard.</p>
        
        <div class="card">
            <h2>Quick Stats</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>Current Grade</h3>
                    <p id="student-class">Loading...</p>
                </div>
                <div class="stat-item">
                    <h3>Attendance</h3>
                    <p>95%</p>
                </div>
                <div class="stat-item">
                    <h3>GPA</h3>
                    <p>3.8</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Upcoming Exams</h2>
            <table>
                <thead>
                    <tr>
                        <th>Exam Name</th>
                        <th>Subject</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="exams-table-body">
                </tbody>
            </table>
        </div>
    </main>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzDvGPCnsWEPUE-hRS1MhhCPlK19u5KAomHM_bt1MN9jrtNv4l3ZAXiVPG7CVNXECQJ/exec';
    const loggedInUserId = localStorage.getItem('loggedInUser');

    // Check if the user is logged in
    if (!loggedInUserId) {
        window.location.href = "LOGIN.html";
    }

    async function fetchStudentData() {
        try {
            // Fetch students and exams data
            const [studentsRes, examsRes] = await Promise.all([
                fetch(`${scriptURL}?action=getStudents`),
                fetch(`${scriptURL}?action=getExams`)
            ]);
            
            const studentsData = await studentsRes.json();
            const examsData = await examsRes.json();
            
            // Find the logged-in student's data
            const loggedInStudent = studentsData.students.find(student => student.AdmissionNumber === loggedInUserId);
            
            if (loggedInStudent) {
                document.getElementById('student-name-heading').textContent = `Welcome, ${loggedInStudent.StudentName}`;
                document.getElementById('student-class').textContent = loggedInStudent.Class;
                
                // Filter exams relevant to the student's class
                const relevantExams = examsData.exams.filter(exam => exam.Class === loggedInStudent.Class);
                
                const examsTableBody = document.getElementById('exams-table-body');
                examsTableBody.innerHTML = ''; // Clear existing content
                
                relevantExams.forEach(exam => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${exam.ExamName}</td>
                        <td>${exam.Subject}</td>
                        <td>${exam.Date}</td>
                    `;
                    examsTableBody.appendChild(row);
                });
            } else {
                console.error('Logged-in student not found.');
                document.getElementById('student-name-heading').textContent = 'User Not Found';
                document.getElementById('student-class').textContent = 'N/A';
            }
        } catch (error) {
            console.error('Error fetching student data:', error);
            document.getElementById('student-name-heading').textContent = 'Error Loading Data';
            document.getElementById('student-class').textContent = 'N/A';
        }
    }

    // Call the function to load the data when the page loads
    fetchStudentData();
</script>
</body>
</html>